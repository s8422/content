---
# -------------------------------------------------------------------------------------------------------------------- #
# GENERAL
# -------------------------------------------------------------------------------------------------------------------- #

title: 'LVM: Расширение тома ROOT'
description: ''
icon: 'far fa-file-lines'
categories:
  - 'lvm'
tags:
  - 'lvm'
  - 'pv'
  - 'vg'
  - 'lv'
  - 'resize2fs'
  - 'xfs_growfs'
  - 'parted'
authors:
  - 'KaiKimera'
sources:
  - ''
license: 'CC-BY-SA-4.0'
complexity: '0'
toc: 1
comments: 1

# -------------------------------------------------------------------------------------------------------------------- #
# DATE
# -------------------------------------------------------------------------------------------------------------------- #

date: '2026-02-13T11:51:56+03:00'
publishDate: '2026-02-13T11:51:56+03:00'
lastMod: '2026-02-13T11:51:56+03:00'

# -------------------------------------------------------------------------------------------------------------------- #
# META
# -------------------------------------------------------------------------------------------------------------------- #

type: 'articles'
hash: '3ebb98a40c697fd44f99042920929189a161f4c7'
uuid: '3ebb98a4-0c69-5fd4-8f99-042920929189'
slug: '3ebb98a4-0c69-5fd4-8f99-042920929189'

draft: 0
---

Иногда требуется увеличение корневого раздела {{< tag "Linux" >}} в LVM-конфигурации. Рассмотрим, как это можно сделать без остановки виртуальной машины...

<!--more-->

## Исходные данные

Имеется виртуальная машина с диском `sda` размером `20 GB`:

```terminal
lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda               8:0    0   20G  0 disk
├─sda1            8:1    0    1M  0 part
├─sda2            8:2    0  1.9G  0 part /boot
└─sda3            8:3    0 18.1G  0 part
  ├─system-swap 254:0    0  3.8G  0 lvm  [SWAP]
  └─system-root 254:1    0 14.3G  0 lvm  /
```

Увеличиваем размер виртуального диска `sda` на `10 GB`:

```terminal
lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda               8:0    0   30G  0 disk
├─sda1            8:1    0    1M  0 part
├─sda2            8:2    0  1.9G  0 part /boot
└─sda3            8:3    0 18.1G  0 part
  ├─system-swap 254:0    0  3.8G  0 lvm  [SWAP]
  └─system-root 254:1    0 14.3G  0 lvm  /
```

## Экспорт параметров

Для начала экспортируем заранее подготовленные параметры в переменные окружения:

```bash
export PV='/dev/sda3'; export LV='system-root'
```

### Параметры

- `PV='/dev/sda3'` - имя физического тома (PV).
- `LV='system-root'` - имя группы логических томов (VG) `system` и логического тома (LV) `root`.

## Расширение LVM

{{< alert "tip" >}}
При увеличении размера `sda`, утилита `parted` может показать ошибку `Unable to satisfy all constraints on the partition`. Эта ошибка является следствием того, что при увеличении размера виртуального диска, таблица разделов (GPT) больше не записывается в правильном месте на диске. В следующей команде применён флаг `-f` (`--fix`) для исправления ошибки. При помощи этого флага, утилита `parted` исправляет таблицу разделов диска.

Если утилита `parted`, установленная в системе, не имеет флага `-f` (`--fix`), то необходимо отдельно запустить утилиту `parted`, исправить таблицу разделов и расширить раздел самостоятельно.
{{< /alert >}}

Увеличение раздела `root` при помощи одной команды:

```bash
echo 1 > "/sys/block/$( echo "${PV##*/}" | sed 's/[0-9]*//g' )/device/rescan" && parted -sf -a 'optimal' -- "${PV//[0-9]/}" "resizepart ${PV//[^0-9]/} 100%" && pvresize "${PV}" && lvextend -l +100%FREE "/dev/${LV%%-*}/${LV##*-}"
```

В этой команде имеется 4 под-команды:

- `rescan` - обновить информацию об устройстве `sda`.
- `parted` - расширить раздел `sda3` на всё свободное место.
- `pvresize` - расширить физический том **PV**.
- `lvextend` - расширить логический том **LV**.

### Расширение ФС

Расширить файловую систему `ext4`:

```bash
resize2fs "/dev/${LV%%-*}/${LV##*-}"
```

Расширить файловую систему `xfs`:

```bash
xfs_growfs -d "/dev/${LV%%-*}/${LV##*-}"
```

## Итоговые значения

В итоге, имеем увеличение раздела `sda3/system-root` на всё свободное место:

```terminal
lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda               8:0    0   30G  0 disk
├─sda1            8:1    0    1M  0 part
├─sda2            8:2    0  1.9G  0 part /boot
└─sda3            8:3    0 28.1G  0 part
  ├─system-swap 254:0    0  3.8G  0 lvm  [SWAP]
  └─system-root 254:1    0 24.3G  0 lvm  /
```
